{% extends 'admin/_layout.twig' %}
{% block title %}Nuovo Utente — photoCMS{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-gray-900">Nuovo Utente</h1>
</div>

<div class="card p-6">
  <form method="post" action="/admin/users" class="space-y-6">
    <input type="hidden" name="csrf" value="{{ csrf }}">
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Nome *</label>
        <input class="form-input w-full border border-gray-300 rounded-lg" type="text" name="first_name" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cognome *</label>
        <input class="form-input w-full border border-gray-300 rounded-lg" type="text" name="last_name" required>
      </div>
    </div>
    
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
      <input class="form-input w-full border border-gray-300 rounded-lg" type="email" name="email" required>
    </div>
    
    <div class="border border-gray-200 rounded-lg p-4">
      <h3 class="text-lg font-medium text-gray-900 mb-3">Credenziali</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
          <input class="form-input w-full border border-gray-300 rounded-lg" type="password" name="password" minlength="8" required>
          <small class="text-gray-500">Minimo 8 caratteri</small>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Conferma Password *</label>
          <input class="form-input w-full border border-gray-300 rounded-lg" type="password" name="confirm_password" minlength="8" required>
        </div>
      </div>
    </div>
    
    <div class="border border-gray-200 rounded-lg p-4">
      <h3 class="text-lg font-medium text-gray-900 mb-3">Autorizzazioni</h3>
      <div class="space-y-3">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Ruolo</label>
          <select class="form-input w-full border border-gray-300 rounded-lg" name="role">
            <option value="user">Utente - Può scaricare immagini dal frontend</option>
            <option value="admin">Amministratore - Accesso completo al backend</option>
          </select>
        </div>
        <div class="flex items-center">
          <input type="checkbox" id="is_active" name="is_active" value="1" checked class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50">
          <label for="is_active" class="ml-2 text-sm text-gray-700">Account attivo</label>
        </div>
      </div>
    </div>
    
    <div class="flex gap-3 pt-4 border-t">
      <button class="btn-primary" type="submit">Crea Utente</button>
      <a class="btn-secondary" href="/admin/users">Annulla</a>
    </div>
  </form>
</div>

<script>
// Password confirmation validation
document.addEventListener('DOMContentLoaded', function() {
  const password = document.querySelector('input[name="password"]');
  const confirmPassword = document.querySelector('input[name="confirm_password"]');
  
  function validatePasswords() {
    if (password.value !== confirmPassword.value) {
      confirmPassword.setCustomValidity('Le password non coincidono');
    } else {
      confirmPassword.setCustomValidity('');
    }
  }
  
  password.addEventListener('input', validatePasswords);
  confirmPassword.addEventListener('input', validatePasswords);
});
</script>
{% endblock %}