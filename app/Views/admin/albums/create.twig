{% extends 'admin/_layout.twig' %}
{% block title %}Nuovo album — photoCMS{% endblock %}
{% block content %}
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-black">Nuovo Album</h1>
  </div>
  <form id="album-form" method="post" action="/admin/albums">
    <input type="hidden" name="csrf" value="{{ csrf }}">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 card p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-black mb-1">Titolo</label>
          <input class="form-input border-gray-300 focus:border-black focus:ring-black" type="text" name="title" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-black mb-1">Slug</label>
          <input class="form-input border-gray-300 focus:border-black focus:ring-black" type="text" name="slug" placeholder="(auto se vuoto)">
        </div>
        <div>
          <label class="block text-sm font-medium text-black mb-1">Excerpt</label>
          <textarea class="form-input border-gray-300 focus:border-black focus:ring-black" name="excerpt" rows="4" placeholder="Breve descrizione dell'album..."></textarea>
          <p class="text-xs text-gray-600 mt-1">Descrizione breve che appare nelle anteprime</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-black mb-1">Contenuto Completo</label>
          <textarea class="form-input richtext border-gray-300 focus:border-black focus:ring-black" name="body" rows="6" placeholder="Descrizione completa dell'album..."></textarea>
          <p class="text-xs text-gray-600 mt-1">Contenuto completo con formattazione (supporta grassetto, corsivo, elenchi, etc.)</p>
        </div>
      </div>
      <div class="card p-6 space-y-4">
        <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Categorie</label>
        <select name="categories[]" id="album-categories" class="form-input" multiple required>
          {% for c in categories %}
            <option value="{{ c.id }}">{{ c.name }}</option>
          {% endfor %}
        </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Data scatto</label>
          <input class="form-input" type="date" name="shoot_date">
        </div>
        <div class="flex items-center gap-2">
          <input class="h-4 w-4" type="checkbox" name="show_date" id="show_date" checked>
          <label class="text-sm text-gray-700" for="show_date">Mostra data</label>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tag</label>
          <select class="form-input" name="tags[]" id="album-tags" multiple>
            {% for t in tags %}
              <option value="{{ t.id }}">{{ t.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Template</label>
          <select class="form-input" name="template_id">
            <option value="">Seleziona un template...</option>
            {% for template in templates %}
              <option value="{{ template.id }}">{{ template.name }}</option>
            {% endfor %}
          </select>
        </div>
        
        <!-- Equipment Section -->
        <div class="border-t pt-4 mt-4">
          <h3 class="text-sm font-medium text-gray-900 mb-3">Equipment</h3>
          
          <div class="space-y-3">
            <div>
              <div class="flex items-center justify-between mb-1">
                <label class="block text-sm font-medium text-gray-700">Cameras</label>
                <label class="flex items-center text-xs text-gray-600">
                  <input type="checkbox" id="cameras-custom-toggle" class="mr-1 rounded">
                  Usa campi liberi
                </label>
              </div>
              <select class="form-input" name="cameras[]" id="album-cameras" multiple>
                {% for camera in cameras %}
                  <option value="{{ camera.id }}">{{ camera.make }} {{ camera.model }}</option>
                {% endfor %}
              </select>
              <div id="cameras-custom-fields" class="mt-2 hidden">
                <textarea name="custom_cameras" placeholder="Una camera per riga, es: Leica M6, Canon AE-1" class="form-input" rows="3"></textarea>
                <p class="text-xs text-gray-500 mt-1">Una camera per riga</p>
              </div>
            </div>
            
            <div>
              <div class="flex items-center justify-between mb-1">
                <label class="block text-sm font-medium text-gray-700">Lenses</label>
                <label class="flex items-center text-xs text-gray-600">
                  <input type="checkbox" id="lenses-custom-toggle" class="mr-1 rounded">
                  Usa campi liberi
                </label>
              </div>
              <select class="form-input" name="lenses[]" id="album-lenses" multiple>
                {% for lens in lenses %}
                  <option value="{{ lens.id }}">{{ lens.brand }} {{ lens.model }}</option>
                {% endfor %}
              </select>
              <div id="lenses-custom-fields" class="mt-2 hidden">
                <textarea name="custom_lenses" placeholder="Una lente per riga, es: Canon 50mm f/1.4, Leica 35mm f/2" class="form-input" rows="3"></textarea>
                <p class="text-xs text-gray-500 mt-1">Una lente per riga</p>
              </div>
            </div>
            
            <div>
              <div class="flex items-center justify-between mb-1">
                <label class="block text-sm font-medium text-gray-700">Films</label>
                <label class="flex items-center text-xs text-gray-600">
                  <input type="checkbox" id="films-custom-toggle" class="mr-1 rounded">
                  Usa campi liberi
                </label>
              </div>
              <select class="form-input" name="films[]" id="album-films" multiple>
                {% for film in films %}
                  <option value="{{ film.id }}">{{ film.brand }} {{ film.name }}</option>
                {% endfor %}
              </select>
              <div id="films-custom-fields" class="mt-2 hidden">
                <textarea name="custom_films" placeholder="Un film per riga, es: Kodak Portra 400, Fuji Pro 400H" class="form-input" rows="3"></textarea>
                <p class="text-xs text-gray-500 mt-1">Un film per riga</p>
              </div>
            </div>
            
            <div>
              <div class="flex items-center justify-between mb-1">
                <label class="block text-sm font-medium text-gray-700">Developers</label>
                <label class="flex items-center text-xs text-gray-600">
                  <input type="checkbox" id="developers-custom-toggle" class="mr-1 rounded">
                  Usa campi liberi
                </label>
              </div>
              <select class="form-input" name="developers[]" id="album-developers" multiple>
                {% for developer in developers %}
                  <option value="{{ developer.id }}">{{ developer.name }}</option>
                {% endfor %}
              </select>
              <div id="developers-custom-fields" class="mt-2 hidden">
                <textarea name="custom_developers" placeholder="Uno sviluppatore per riga, es: Kodak D-76, Rodinal" class="form-input" rows="2"></textarea>
                <p class="text-xs text-gray-500 mt-1">Uno sviluppatore per riga</p>
              </div>
            </div>
            
            <div>
              <div class="flex items-center justify-between mb-1">
                <label class="block text-sm font-medium text-gray-700">Labs</label>
                <label class="flex items-center text-xs text-gray-600">
                  <input type="checkbox" id="labs-custom-toggle" class="mr-1 rounded">
                  Usa campi liberi
                </label>
              </div>
              <select class="form-input" name="labs[]" id="album-labs" multiple>
                {% for lab in labs %}
                  <option value="{{ lab.id }}">{{ lab.name }}</option>
                {% endfor %}
              </select>
              <div id="labs-custom-fields" class="mt-2 hidden">
                <textarea name="custom_labs" placeholder="Un laboratorio per riga, es: Carmencita Film Lab, The FPPF" class="form-input" rows="2"></textarea>
                <p class="text-xs text-gray-500 mt-1">Un laboratorio per riga</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Locations -->
        <div class="border-t pt-4 mt-4">
          <h3 class="text-sm font-medium text-gray-900 mb-3">Locations</h3>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Seleziona luoghi (multi)</label>
            <select class="form-input" name="locations[]" id="album-locations" multiple>
              {% for loc in locations %}
                <option value="{{ loc.id }}">{{ loc.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        
        <div class="border-t pt-4 mt-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password album (opzionale)</label>
            <input class="form-input" type="password" name="password" placeholder="Imposta password per proteggere l'album">
            <p class="text-xs text-gray-500 mt-1">Se impostata, l’album richiederà password per l’accesso pubblico</p>
          </div>
          <div class="flex items-center gap-2 mt-3">
            <input class="h-4 w-4" type="checkbox" name="allow_downloads" id="allow_downloads">
            <label class="text-sm text-gray-700" for="allow_downloads">Consenti download delle immagini</label>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Ordine</label>
            <input class="form-input" type="number" name="sort_order" value="0">
          </div>
          <div class="flex items-center gap-2 mt-3">
            <input class="h-4 w-4" type="checkbox" name="is_published" id="pub">
            <label class="text-sm text-gray-700" for="pub">Pubblica subito</label>
          </div>
        </div>
      </div>
    </div>

    <div class="card p-5 mt-6">
      <div class="flex items-center justify-between flex-wrap gap-3 mb-4">
        <div class="flex items-center gap-2">
          <label class="text-sm text-gray-700">Ordina:</label>
          <select id="sort-images" class="form-input text-sm py-1.5">
            <option value="manual">Manuale</option>
            <option value="created_newest">Data (più recenti)</option>
            <option value="created_oldest">Data (più vecchie)</option>
            <option value="id_asc">ID crescente</option>
            <option value="id_desc">ID decrescente</option>
          </select>
          <button id="save-order" class="btn-secondary btn-sm" type="button" disabled>Salva ordine</button>
        </div>
      </div>
      <div id="uploader" class="w-full border-2 border-dashed rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer flex items-center justify-center min-h-[260px]">
        <input id="file-input" type="file" multiple class="hidden" accept="image/*">
        <div class="text-center text-gray-600">
          <i class="fa-regular fa-images mb-2" style="font-size:38px"></i>
          <div class="text-base">Trascina qui le immagini o clicca per selezionarle</div>
          <div class="text-sm text-gray-500 mt-1">L’album verrà creato automaticamente al primo caricamento</div>
        </div>
      </div>
    </div>

    <div class="flex gap-3 pt-6">
      <button class="bg-black hover:bg-gray-800 text-white px-6 py-2 rounded font-medium transition-colors" type="submit">Salva Album</button>
      <a class="bg-gray-100 hover:bg-gray-200 text-black px-6 py-2 rounded font-medium transition-colors" href="/admin/albums">Annulla</a>
    </div>
  </form>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css">
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tinymce@6.8.3/tinymce.min.js" referrerpolicy="no-referrer"></script>
  
  <!-- Modal edit image (for when images are present after upload) -->
  <div id="image-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white w-full max-w-2xl rounded shadow-lg overflow-hidden">
      <div class="px-5 py-3 border-b flex items-center justify-between">
        <h3 class="text-lg font-medium">Modifica immagine</h3>
        <button type="button" id="image-modal-close" class="text-gray-500 hover:text-black">✕</button>
      </div>
      <form id="image-form" method="post">
        <input type="hidden" name="csrf" value="{{ csrf }}">
        <div class="p-5 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Alt text</label>
            <input type="text" name="alt_text" id="f-alt" class="form-input">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Titolo/Caption</label>
            <input type="text" name="caption" id="f-caption" class="form-input">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Camera</label>
            <select name="camera_id" id="f-camera" class="form-input">
              <option value="">—</option>
              {% for camera in cameras %}
                <option value="{{ camera.id }}">{{ camera.make }} {{ camera.model }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Lens</label>
            <select name="lens_id" id="f-lens" class="form-input">
              <option value="">—</option>
              {% for lens in lenses %}
                <option value="{{ lens.id }}">{{ lens.brand }} {{ lens.model }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Film</label>
            <select name="film_id" id="f-film" class="form-input">
              <option value="">—</option>
              {% for film in films %}
                <option value="{{ film.id }}">{{ film.brand }} {{ film.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Developer</label>
            <select name="developer_id" id="f-developer" class="form-input">
              <option value="">—</option>
              {% for dev in developers %}
                <option value="{{ dev.id }}">{{ dev.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Lab</label>
            <select name="lab_id" id="f-lab" class="form-input">
              <option value="">—</option>
              {% for lab in labs %}
                <option value="{{ lab.id }}">{{ lab.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
            <select name="location_id" id="f-location" class="form-input">
              <option value="">—</option>
              {% for loc in locations %}
                <option value="{{ loc.id }}">{{ loc.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Custom camera</label>
            <input type="text" name="custom_camera" id="f-custom-camera" class="form-input">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Custom lens</label>
            <input type="text" name="custom_lens" id="f-custom-lens" class="form-input">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Custom film</label>
            <input type="text" name="custom_film" id="f-custom-film" class="form-input">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ISO</label>
            <input type="number" name="iso" id="f-iso" class="form-input">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Shutter</label>
            <input type="text" name="shutter_speed" id="f-shutter" class="form-input" placeholder="1/125">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Aperture</label>
            <input type="number" step="0.1" name="aperture" id="f-aperture" class="form-input" placeholder="2.8">
          </div>
        </div>
        <div class="px-5 py-3 border-t flex items-center justify-end gap-2">
          <button type="button" id="image-cancel" class="btn-secondary">Annulla</button>
          <button type="submit" class="btn-primary">Salva</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    const tagSelect = new TomSelect('#album-tags',{plugins:['remove_button'],create:false,placeholder:'Seleziona tag...'});
    const categorySelect = new TomSelect('#album-categories',{plugins:['remove_button'],create:false,placeholder:'Seleziona categorie...'});
    const cameraSelect = new TomSelect('#album-cameras',{plugins:['remove_button'],create:false,placeholder:'Seleziona cameras...'});
    const lensSelect = new TomSelect('#album-lenses',{plugins:['remove_button'],create:false,placeholder:'Seleziona lenses...'});
    const filmSelect = new TomSelect('#album-films',{plugins:['remove_button'],create:false,placeholder:'Seleziona films...'});
    const developerSelect = new TomSelect('#album-developers',{plugins:['remove_button'],create:false,placeholder:'Seleziona developers...'});
    const labSelect = new TomSelect('#album-labs',{plugins:['remove_button'],create:false,placeholder:'Seleziona labs...'});
    const locationSelect = new TomSelect('#album-locations',{plugins:['remove_button'],create:false,placeholder:'Seleziona luoghi...'});
    
    // Ensure form synchronization before submit
    document.querySelector('form').addEventListener('submit', function(e) {
      // Force TomSelect to sync with original form fields
      tagSelect.sync();
      categorySelect.sync();
      cameraSelect.sync();
      lensSelect.sync();
      filmSelect.sync();
      developerSelect.sync();
      labSelect.sync();
      locationSelect.sync();
      locationSelect.sync();
      
      console.log('Form submitting with tags:', document.getElementById('album-tags').value);
      console.log('Form submitting with cameras:', document.getElementById('album-cameras').value);
    });

    // Equipment toggle handlers
    function setupEquipmentToggle(equipmentType) {
      const toggle = document.getElementById(`${equipmentType}-custom-toggle`);
      const selectField = document.getElementById(`album-${equipmentType}`);
      const customFields = document.getElementById(`${equipmentType}-custom-fields`);
      
      if (!toggle || !selectField || !customFields) return;
      
      toggle.addEventListener('change', function() {
        if (this.checked) {
          selectField.style.display = 'none';
          customFields.classList.remove('hidden');
          // Clear TomSelect selection
          const tomSelect = selectField.tomselect;
          if (tomSelect) tomSelect.clear();
        } else {
          selectField.style.display = 'block';
          customFields.classList.add('hidden');
          // Clear custom field
          const textarea = customFields.querySelector('textarea');
          if (textarea) textarea.value = '';
        }
      });
    }
    
    // Setup all equipment toggles
    ['cameras', 'lenses', 'films', 'developers', 'labs'].forEach(setupEquipmentToggle);

    // Initialize TinyMCE
    if (window.tinymce) {
      tinymce.init({
        selector: 'textarea.richtext',
        menubar: false,
        statusbar: false,
        branding: false,
        plugins: 'link lists autoresize',
        toolbar: 'undo redo | styles | bold italic | bullist numlist | blockquote | link | removeformat',
        block_formats: 'Paragrafo=p; Sottotitolo=h3; Titolo sezione=h2; Nota=h4',
        default_link_target: '_blank',
        link_default_protocol: 'https',
        rel_list: [{title: 'noopener', value: 'noopener'},{title:'noreferrer', value:'noreferrer'}],
        content_css: false,
        content_style: 'body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:#111; line-height:1.7} a{color:#000; text-decoration:underline} blockquote{border-left:3px solid #e5e7eb; margin:1rem 0; padding-left:.75rem; color:#444}',
        valid_elements: 'p,br,strong/b,em/i,ul,ol,li,blockquote,a[href|target|rel],h2,h3,h4,hr',
        height: 300,
        skin: 'oxide',
        content_style: 'body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #111827; }',
        toolbar_mode: 'wrap',
      });
    }

    // Create-first-then-upload flow
    let createdAlbumId = null;
    const form = document.getElementById('album-form');
    const uploader = document.getElementById('uploader');
    const input = document.getElementById('file-input');
    const csrf = form.querySelector('input[name="csrf"]').value;

    function gatherFormData(){
      const fd = new URLSearchParams();
      new FormData(form).forEach((v,k)=>{ if(k!=='csrf') fd.append(k, typeof v === 'string' ? v : String(v)); });
      return fd.toString();
    }
    async function ensureAlbumId(){
      if (createdAlbumId) return createdAlbumId;
      const body = gatherFormData();
      const res = await fetch(form.action, { method:'POST', headers:{ 'Content-Type':'application/x-www-form-urlencoded', 'X-CSRF-Token': csrf, 'Accept':'application/json' }, body });
      const data = await res.json();
      if (!data || !data.id) throw new Error('Creazione album fallita');
      createdAlbumId = data.id;
      return createdAlbumId;
    }
    uploader.addEventListener('click', ()=> { input.click(); });
    ['dragover','dragleave'].forEach(ev=>uploader.addEventListener(ev, e=>{ e.preventDefault(); uploader.classList.toggle('bg-gray-100', ev==='dragover'); }));
    uploader.addEventListener('drop', async e=>{
      e.preventDefault(); uploader.classList.remove('bg-gray-100');
      if (!e.dataTransfer) return; const files = Array.from(e.dataTransfer.files);
      await uploadFiles(files);
    });
    input.addEventListener('change', async ()=>{ await uploadFiles(Array.from(input.files||[])); input.value=''; });

    async function uploadFiles(files){
      if (!files.length) return;
      // basic validation: require title and at least one category before auto-create
      const titleEl = form.querySelector('input[name="title"]');
      const catsEl = document.getElementById('album-categories');
      const hasTitle = titleEl && titleEl.value.trim().length > 0;
      const hasCat = catsEl && Array.from(catsEl.selectedOptions).length > 0;
      if (!hasTitle || !hasCat) {
        alert('Inserisci almeno Titolo e una Categoria prima di caricare immagini.');
        return;
      }
      const id = await ensureAlbumId();
      for (const f of files){
        const fd = new FormData(); fd.append('file', f);
        await fetch(`/admin/albums/${id}/upload`, { method:'POST', headers:{ 'X-CSRF-Token': csrf, 'Accept':'application/json' }, body: fd });
      }
      // Redirect to edit to manage ordering and details
      window.location.href = `/admin/albums/${id}/edit`;
    }
  </script>
  <style>
    /* TomSelect wrapper - no z-index, natural stacking */
    .ts-wrapper {
      position: relative !important;
      background-color: #ffffff !important;
      border-radius: 0.375rem !important;
      width: 100% !important;
      display: block !important;
    }
    
    .ts-wrapper .ts-control {
      background-color: #ffffff !important;
      border: 1px solid #d1d5db !important;
      position: relative !important;
      width: 100% !important;
      min-height: 38px !important;
    }
    
    /* Only the dropdown should have high z-index */
    .ts-dropdown { 
      z-index: 99999 !important; 
      background-color: #ffffff !important; 
      border: 1px solid #d1d5db !important;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
      position: absolute !important;
      top: 100% !important;
      left: 0 !important;
      right: 0 !important;
      width: 100% !important;
      border-radius: 0.375rem !important;
      margin-top: 1px !important;
    }
    
    .ts-dropdown-content {
      z-index: 99999 !important;
      background-color: #ffffff !important;
      max-height: 200px !important;
      overflow-y: auto !important;
      width: 100% !important;
    }
    
    .ts-dropdown .option {
      background-color: #ffffff !important;
      color: #374151 !important;
      padding: 8px 12px !important;
      cursor: pointer !important;
      border: none !important;
      width: 100% !important;
      display: block !important;
      box-sizing: border-box !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }
    
    .ts-dropdown .option:hover,
    .ts-dropdown .option.active {
      background-color: #f3f4f6 !important;
      color: #111827 !important;
    }
    
    .ts-dropdown .option.selected {
      background-color: #3b82f6 !important;
      color: #ffffff !important;
    }
    
    /* Equipment section specific - no z-index for wrappers */
    #album-cameras + .ts-wrapper,
    #album-lenses + .ts-wrapper,
    #album-films + .ts-wrapper, 
    #album-developers + .ts-wrapper,
    #album-labs + .ts-wrapper {
      background-color: #ffffff !important;
      width: 100% !important;
    }
    
    /* Only dropdowns get high z-index */
    #album-cameras + .ts-wrapper .ts-dropdown,
    #album-lenses + .ts-wrapper .ts-dropdown,
    #album-films + .ts-wrapper .ts-dropdown,
    #album-developers + .ts-wrapper .ts-dropdown,
    #album-labs + .ts-wrapper .ts-dropdown {
      z-index: 99999 !important;
      position: absolute !important;
      width: 100% !important;
    }
    
    /* Equipment section normal stacking */
    .border-t.pt-4.mt-4 {
      position: relative !important;
      background-color: #ffffff !important;
    }
    
    /* Full width for all TomSelect elements */
    .ts-wrapper,
    .ts-wrapper .ts-control,
    .ts-wrapper input {
      width: 100% !important;
      box-sizing: border-box !important;
    }
    
    /* Additional ID-based targeting for full width */
    #album-cameras-ts-dropdown,
    #album-lenses-ts-dropdown,
    #album-films-ts-dropdown,
    #album-developers-ts-dropdown,
    #album-labs-ts-dropdown {
      z-index: 99999 !important;
      background-color: #ffffff !important;
      border: 1px solid #d1d5db !important;
      border-radius: 0.375rem !important;
      position: absolute !important;
      width: 100% !important;
      left: 0 !important;
      right: 0 !important;
    }
  </style>
{% endblock %}
