{% extends 'admin/_layout.twig' %}
{% block title %}{{ trans('admin.templates.new') }} â€” Cimaise{% endblock %}
{% block content %}
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">{{ trans('admin.templates.new') }}</h1>
      <p class="text-gray-600 mt-1">{{ trans('admin.templates.create_description') }}</p>
    </div>
    <a href="{{ base_path }}/admin/templates" class="btn-secondary">
      <i class="fas fa-arrow-left mr-2"></i>{{ trans('admin.templates.back_to_list') }}
    </a>
  </div>

  <form method="post" action="{{ base_path }}/admin/templates" class="space-y-6">
    <input type="hidden" name="csrf" value="{{ csrf }}">

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-6">
        <div class="card p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">{{ trans('admin.templates.general_info') }}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">{{ trans('admin.templates.name_required') }}</label>
              <input class="form-input" type="text" name="name" required>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">{{ trans('admin.templates.slug') }}</label>
              <input class="form-input" type="text" name="slug" placeholder="{{ trans('admin.templates.slug_placeholder') }}">
            </div>
          </div>
          <div class="mt-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">{{ trans('admin.templates.description_label') }}</label>
            <textarea class="form-input" name="description" rows="3" placeholder="{{ trans('admin.templates.description_placeholder') }}"></textarea>
          </div>
        </div>

        <div class="card p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">{{ trans('admin.templates.layout_settings') }}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">{{ trans('admin.templates.layout_type') }}</label>
              <select class="form-input" name="layout">
                <option value="grid">{{ trans('admin.templates.grid') }}</option>
                <option value="masonry">{{ trans('admin.templates.masonry') }}</option>
                <option value="slideshow">{{ trans('admin.templates.slideshow') }}</option>
                <option value="fullscreen">{{ trans('admin.templates.fullscreen') }}</option>
              </select>
            </div>
            <div>
              <label class="flex items-center">
                <input type="checkbox" name="masonry" class="form-checkbox">
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.enable_masonry') }}</span>
              </label>
            </div>
          </div>

          <div class="border-t pt-4">
            <h3 class="text-md font-medium text-gray-800 mb-3">{{ trans('admin.templates.columns_per_device') }}</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  <i class="fas fa-desktop text-gray-500 mr-1"></i>Desktop
                </label>
                <select class="form-input" name="columns_desktop">
                  <option value="1">1 {{ trans('admin.templates.column') }}</option>
                  <option value="2">2 {{ trans('admin.templates.columns') }}</option>
                  <option value="3" selected>3 {{ trans('admin.templates.columns') }}</option>
                  <option value="4">4 {{ trans('admin.templates.columns') }}</option>
                  <option value="5">5 {{ trans('admin.templates.columns') }}</option>
                  <option value="6">6 {{ trans('admin.templates.columns') }}</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  <i class="fas fa-tablet-alt text-gray-500 mr-1"></i>Tablet
                </label>
                <select class="form-input" name="columns_tablet">
                  <option value="1">1 {{ trans('admin.templates.column') }}</option>
                  <option value="2" selected>2 {{ trans('admin.templates.columns') }}</option>
                  <option value="3">3 {{ trans('admin.templates.columns') }}</option>
                  <option value="4">4 {{ trans('admin.templates.columns') }}</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  <i class="fas fa-mobile-alt text-gray-500 mr-1"></i>Mobile
                </label>
                <select class="form-input" name="columns_mobile">
                  <option value="1" selected>1 {{ trans('admin.templates.column') }}</option>
                  <option value="2">2 {{ trans('admin.templates.columns') }}</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="card p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">{{ trans('admin.templates.photoswipe_settings') }}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="space-y-3">
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_loop" class="form-checkbox" checked>
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.infinite_loop') }}</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_zoom" class="form-checkbox" checked>
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.enable_zoom') }}</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_share" class="form-checkbox">
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.share_button') }}</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_counter" class="form-checkbox" checked>
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.image_counter') }}</span>
              </label>
            </div>
            <div class="space-y-3">
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_arrowkeys" class="form-checkbox" checked>
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.arrow_navigation') }}</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_esckey" class="form-checkbox" checked>
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.esc_close') }}</span>
              </label>
              <label class="flex items-center">
                <input type="checkbox" name="photoswipe_pan_to_next" class="form-checkbox">
                <span class="ml-2 text-sm text-gray-700">{{ trans('admin.templates.pan_to_next') }}</span>
              </label>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">{{ trans('admin.templates.bg_opacity') }}</label>
              <input class="form-input" type="number" name="photoswipe_bg_opacity" min="0" max="1" step="0.1" value="0.8">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">{{ trans('admin.templates.image_spacing') }}</label>
              <input class="form-input" type="number" name="photoswipe_spacing" min="0" max="1" step="0.01" value="0.12">
            </div>
          </div>
        </div>
      </div>

      <div class="space-y-6">
        <div class="card p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">{{ trans('admin.templates.preview') }}</h2>
          <div class="text-sm text-gray-600 space-y-2">
            <p><strong>{{ trans('admin.templates.layout') }}:</strong> <span id="preview-layout">{{ trans('admin.templates.grid') }}</span></p>
            <p><strong>{{ trans('admin.templates.masonry') }}:</strong> <span id="preview-masonry">{{ trans('admin.templates.no') }}</span></p>
            <div class="mt-3">
              <p class="font-medium">{{ trans('admin.templates.columns_label') }}</p>
              <ul class="ml-4 space-y-1">
                <li><i class="fas fa-desktop text-gray-400 mr-1"></i>Desktop: <span id="preview-desktop">3</span></li>
                <li><i class="fas fa-tablet-alt text-gray-400 mr-1"></i>Tablet: <span id="preview-tablet">2</span></li>
                <li><i class="fas fa-mobile-alt text-gray-400 mr-1"></i>Mobile: <span id="preview-mobile">1</span></li>
              </ul>
            </div>
            <p><strong>PhotoSwipe:</strong> {{ trans('admin.templates.photoswipe_enabled') }}</p>
          </div>
        </div>

        <div class="card p-6">
          <div class="flex gap-2">
            <button type="submit" class="btn-primary">{{ trans('admin.templates.create_template') }}</button>
            <a href="{{ base_path }}/admin/templates" class="btn-secondary">{{ trans('admin.templates.cancel') }}</a>
          </div>
        </div>
      </div>
    </div>
  </form>

  <script nonce="{{ csp_nonce() }}">
    // Live preview updates
    const layoutSelect = document.querySelector('select[name="layout"]');
    const desktopSelect = document.querySelector('select[name="columns_desktop"]');
    const tabletSelect = document.querySelector('select[name="columns_tablet"]');
    const mobileSelect = document.querySelector('select[name="columns_mobile"]');
    const masonryCheck = document.querySelector('input[name="masonry"]');

    function updatePreview() {
      document.getElementById('preview-layout').textContent = layoutSelect.options[layoutSelect.selectedIndex].text;
      document.getElementById('preview-desktop').textContent = desktopSelect.value;
      document.getElementById('preview-tablet').textContent = tabletSelect.value;
      document.getElementById('preview-mobile').textContent = mobileSelect.value;
      document.getElementById('preview-masonry').textContent = masonryCheck.checked ? '{{ trans('admin.templates.yes') }}' : '{{ trans('admin.templates.no') }}';
    }

    layoutSelect.addEventListener('change', updatePreview);
    desktopSelect.addEventListener('change', updatePreview);
    tabletSelect.addEventListener('change', updatePreview);
    mobileSelect.addEventListener('change', updatePreview);
    masonryCheck.addEventListener('change', updatePreview);
  </script>
{% endblock %}
