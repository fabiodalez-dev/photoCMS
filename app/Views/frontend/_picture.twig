{# Reusable responsive <picture> partial #}
{# Inputs: img (object/array with width,height,alt_text,original_path), variants (list like image_variants rows) #}
{% set variants_avif = [] %}
{% set variants_webp = [] %}
{% set variants_jpg = [] %}
{% for v in variants %}
  {% set v_url = v.path starts with '/' ? app_url ~ v.path : v.path %}
  {% if v.format == 'avif' %}
    {% set variants_avif = variants_avif|merge([v_url ~ ' ' ~ v.width ~ 'w']) %}
  {% elseif v.format == 'webp' %}
    {% set variants_webp = variants_webp|merge([v_url ~ ' ' ~ v.width ~ 'w']) %}
  {% elseif v.format == 'jpg' %}
    {% set variants_jpg = variants_jpg|merge([v_url ~ ' ' ~ v.width ~ 'w']) %}
  {% endif %}
{% endfor %}

<picture>
  {% if variants_avif %}
    <source type="image/avif" srcset="{{ variants_avif|join(', ') }}" sizes="(min-width:1024px) 50vw, 90vw">
  {% endif %}
  {% if variants_webp %}
    <source type="image/webp" srcset="{{ variants_webp|join(', ') }}" sizes="(min-width:1024px) 50vw, 90vw">
  {% endif %}
  {% set picture_src = (variants_jpg|length > 0) ? variants_jpg[0]|split(' ')|first : img.original_path %}
  <img src="{% if picture_src starts with '/' %}{{ app_url }}{{ picture_src }}{% else %}{{ picture_src }}{% endif %}"
       alt="{{ img.alt_text|e }}"
       width="{{ img.width }}"
       height="{{ img.height }}"
       loading="lazy" decoding="async"
       class="w-full h-full object-cover">
</picture>
