<article class="album-card group cursor-pointer" data-album-id="{{ album.id }}">
  <a href="{{ base_path }}/album/{{ album.slug }}" class="block">
    <div class="aspect-[3/2] overflow-hidden bg-neutral-100 rounded-sm relative">
      {% if album.cover %}
        <picture>
          {% set variants_avif = [] %}
          {% set variants_webp = [] %}
          {% set variants_jpg = [] %}
          {% for variant in album.cover.variants %}
            {% set variant_url = variant.path starts with '/' ? base_path ~ variant.path : variant.path %}
            {% if variant.format == 'avif' %}
              {% set variants_avif = variants_avif|merge([variant_url ~ ' ' ~ variant.width ~ 'w']) %}
            {% elseif variant.format == 'webp' %}
              {% set variants_webp = variants_webp|merge([variant_url ~ ' ' ~ variant.width ~ 'w']) %}
            {% elseif variant.format == 'jpg' %}
              {% set variants_jpg = variants_jpg|merge([variant_url ~ ' ' ~ variant.width ~ 'w']) %}
            {% endif %}
          {% endfor %}
          
          {# Sizes ottimizzate per album cards grid:
             - Desktop (1280px+): 3-4 colonne = 30vw
             - Laptop (1024px+): 3 colonne = 32vw
             - Tablet (768px+): 2 colonne = 48vw
             - Mobile (640px+): 1 colonna = 95vw
             - Mobile small: full width = 100vw #}
          {% if variants_avif %}
            <source type="image/avif" srcset="{{ variants_avif|join(', ') }}" sizes="(min-width: 1280px) 28vw, (min-width: 1024px) 30vw, (min-width: 768px) 46vw, (min-width: 640px) 95vw, 100vw">
          {% endif %}
          {% if variants_webp %}
            <source type="image/webp" srcset="{{ variants_webp|join(', ') }}" sizes="(min-width: 1280px) 28vw, (min-width: 1024px) 30vw, (min-width: 768px) 46vw, (min-width: 640px) 95vw, 100vw">
          {% endif %}
          
          {% set card_img_url = album.cover.variants[0].path ?? album.cover.original_path %}
          <img src="{% if card_img_url starts with '/' %}{{ base_path }}{{ card_img_url }}{% else %}{{ card_img_url }}{% endif %}" 
               alt="{{ album.cover.alt_text|e }}" 
               width="{{ album.cover.width }}" 
               height="{{ album.cover.height }}"
               loading="lazy" 
               decoding="async"
               class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-105">
        </picture>

        {% if album.category_name %}
        <div class="absolute top-2 left-2">
          {% if album.category_slug %}
          <a href="{{ base_path }}/category/{{ album.category_slug }}" class="inline-flex items-center gap-2 text-xs font-medium px-2.5 py-1 rounded-full border border-neutral-300 bg-neutral-50/95 text-neutral-700 hover:bg-neutral-100 hover:text-black transition-colors" title="{{ album.category_name|e }}">
            <span class="w-1.5 h-1.5 rounded-full bg-neutral-700"></span>{{ album.category_name|e }}
          </a>
          {% else %}
          <span class="inline-flex items-center gap-2 text-xs font-medium px-2.5 py-1 rounded-full border border-neutral-300 bg-neutral-50/95 text-neutral-700" title="{{ album.category_name|e }}">
            <span class="w-1.5 h-1.5 rounded-full bg-neutral-700"></span>{{ album.category_name|e }}
          </span>
          {% endif %}
        </div>
        {% endif %}

      {% else %}
        <div class="w-full h-full bg-neutral-200 flex items-center justify-center">
          <span class="text-neutral-400 text-sm">No cover</span>
        </div>
      {% endif %}
    </div>
    
    <div class="pt-3 pb-2">
      <h3 class="text-lg font-medium text-black group-hover:text-neutral-700 transition-colors">
        {{ album.title|e }}
      </h3>
      
      <div class="flex flex-wrap items-center gap-1 mt-1 text-sm text-neutral-600">
        {% if album.tags %}
          {% for tag in album.tags %}
            <span class="tag">#{{ tag.name|e }}</span>{% if not loop.last %},{% endif %}
          {% endfor %}
        {% endif %}
        {% if album.shoot_date %}
          {% if album.tags %}<span class="text-neutral-400">â€¢</span>{% endif %}
          <time datetime="{{ album.shoot_date }}">{{ album.shoot_date|date('Y') }}</time>
        {% endif %}
      </div>
      
{% if album.excerpt %}
        <p class="mt-2 text-sm text-neutral-600 line-clamp-2">
          {{ album.excerpt|e }}
        </p>
      {% endif %}
    </div>
  </a>
</article>
