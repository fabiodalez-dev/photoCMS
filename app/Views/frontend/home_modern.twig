{% extends 'frontend/_layout_modern.twig' %}

{% block styles %}
<link rel="stylesheet" href="{{ base_path }}/assets/css/home-modern.css">
{% endblock %}

{% block content %}
{# Modern Home Template - Grid-based layout with fixed sidebar #}

<!-- Global Header -->
<div class="global-head">
    <div class="global-head_layout">
        <a href="{{ base_path }}/" class="head-logo_holder">
            {% if site_logo %}
                <img src="{{ base_path ~ site_logo }}" alt="{{ site_title|e('html_attr') }}" class="head-logo_img">
            {% else %}
                <div class="head-logo_text">{{ site_title|e }}</div>
            {% endif %}
        </a>
    </div>
</div>

<!-- Menu Button -->
<div class="menu-btn">
    <div class="menu-btn_text">{{ trans('frontend.home_modern.menu')|default('Menu') }}</div>
</div>

<!-- Main Content -->
<div class="page-content">
    <div class="work-layout">

        <!-- LEFT COLUMN - FIXED (filters only) -->
        <div class="work-col is-static">
            <div class="work-toggle_holder">
                <!-- All work (active) -->
                <div class="toggle-cat_item">
                    <div class="grid-toggle_item is-active" data-filter="all">
                        <div class="grid-toggle">{{ trans('frontend.home_modern.all_work')|default('All work') }}</div>
                    </div>
                </div>
                <!-- Category filters (AJAX filtering) -->
                {% if categories is defined and categories|length > 0 %}
                <div class="toggle-cat_wrap">
                    <div class="toggle-cat_list">
                        {% for category in categories %}
                        <div class="toggle-cat_item">
                            <div class="grid-toggle_item" data-filter="{{ category.slug|e('html_attr') }}">
                                <div class="grid-toggle">{{ category.name|e }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            <!-- Counter -->
            <div class="work-toggle_holder">
                <div class="body-copy">{{ trans('frontend.home_modern.photos')|default('Photos') }}(<span class="case-studies_total">{{ all_images|length }}</span>)</div>
            </div>
            <!-- Info Holder - shows on image hover -->
            <div class="image-grid-info_holder">
                <div data-image-grid-title class="body-copy"></div>
                <p data-image-grid-copy class="paragraph"></p>
            </div>
        </div>

        <!-- RIGHT COLUMN - SCROLLABLE (images grid) -->
        <div class="work-col is-work">
            {% if all_images is defined and all_images|length > 0 %}
            <div class="inf-work_wrap w-dyn-list">
                <div class="inf-work_list w-dyn-items">
                    {% for image in all_images %}
                    {# Get best image URL (prefer md webp) #}
                    {% set image_url = null %}
                    {% for variant in image.variants %}
                        {% if variant.variant == 'md' and variant.format == 'webp' %}
                            {% set image_url = variant.path starts with '/' ? base_path ~ variant.path : base_path ~ '/' ~ variant.path %}
                        {% endif %}
                    {% endfor %}
                    {# Fallback to fallback_src or first variant #}
                    {% if not image_url %}
                        {% set fallback_path = image.fallback_src ?? image.variants[0].path ?? image.original_path %}
                        {% set image_url = fallback_path starts with '/' ? base_path ~ fallback_path : base_path ~ '/' ~ fallback_path %}
                    {% endif %}
                    {% set srcset_parts = [] %}
                    {% for variant in image.variants %}
                        {% if variant.format == 'webp' %}
                            {% set variant_url = variant.path starts with '/' ? base_path ~ variant.path : base_path ~ '/' ~ variant.path %}
                            {% set srcset_parts = srcset_parts|merge([variant_url ~ ' ' ~ variant.width ~ 'w']) %}
                        {% endif %}
                    {% endfor %}

                    <div data-inf-item class="inf-work_item{% if image.category_slug %} category-{{ image.category_slug|e('html_attr') }}{% endif %}"
                         data-main-title="{{ image.album_title|e('html_attr') }}"
                         data-work-title="{{ image.album_title|e('html_attr') }}"
                         data-work-copy="{{ image.album_description|striptags|slice(0, 200)|e('html_attr') }}"
                         data-album-id="{{ image.album_id }}">
                        <a href="{{ base_path }}/album/{{ image.album_slug|e('html_attr') }}" class="inf-work_link">
                            <div class="work-grid_img-holder">
                                <div class="work-grid_img-height">
                                    <img src="{{ image_url }}"
                                         {% if srcset_parts %}srcset="{{ srcset_parts|join(', ')|e('html_attr') }}"{% endif %}
                                         sizes="(min-width: 1024px) 33vw, (min-width: 768px) 50vw, 100vw"
                                         alt="{{ image.alt_text|default(image.album_title)|e('html_attr') }}"
                                         class="img-fill"
                                         loading="lazy"
                                         data-fallback="hide">
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- Empty State -->
            <div class="modern-empty-state">
                <div class="modern-empty-state__content">
                    <i class="fas fa-images modern-empty-state__icon"></i>
                    <h2 class="modern-empty-state__title">{{ home_settings.empty_title|default(trans('frontend.home_modern.empty_title'))|default('No photos yet') }}</h2>
                    <p class="modern-empty-state__text">{{ home_settings.empty_text|default(trans('frontend.home_modern.empty_text'))|default('Check back soon for new content.') }}</p>
                </div>
            </div>
            {% endif %}
        </div>

    </div>
</div>

<!-- Mega Menu Overlay -->
<div class="menu-component">
    <div class="menu-close">
        <div class="menu-btn_text">{{ trans('frontend.home_modern.close')|default('Close') }}</div>
    </div>
    <nav class="mega-menu">
        <a href="{{ base_path }}/" class="mega-menu_link is-current">{{ trans('frontend.menu.home')|default('Home') }}</a>
        <a href="{{ galleries_url|default(base_path ~ '/galleries') }}" class="mega-menu_link">{{ trans('frontend.menu.galleries')|default('Galleries') }}</a>
        {% set about_href = about_url|default('/about') %}
        <a href="{% if about_href starts with '/' %}{{ base_path }}{{ about_href }}{% else %}{{ about_href }}{% endif %}" class="mega-menu_link">{{ trans('frontend.menu.about')|default('About') }}</a>
    </nav>
</div>

<!-- Page Transition Overlay -->
<div class="page-transition"></div>

{% endblock %}

{% block scripts %}
<!-- Modern Home Script (includes Lenis) -->
<script type="module" src="{{ base_path }}/assets/js/home-modern.js"></script>
{% endblock %}
