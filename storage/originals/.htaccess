# ORIGINAL FILES SECURITY
# Protect original uploaded images from direct access

# Allow only specific image formats
<FilesMatch "\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$">
    # Allow access but with security headers
    <IfModule mod_headers.c>
        Header always set X-Content-Type-Options nosniff
        Header always set Content-Security-Policy "default-src 'none'; img-src 'self'"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>
</FilesMatch>

# Block ALL other file types
<FilesMatch "^.*$">
    <FilesMatch "\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$">
        # Already handled above
    </FilesMatch>
    <FilesMatch "^(?!\.(jpg|jpeg|png|gif|webp|bmp|tiff|svg)$).*">
        Require all denied
    </FilesMatch>
</FilesMatch>

# More explicit blocking of dangerous files
<FilesMatch "\.(php|php3|php4|php5|phtml|pl|py|jsp|asp|sh|cgi|exe|bat|com|scr|vbs|js|jar|pif|msi|dll|htaccess|htpasswd|ini|log|sql)$">
    Require all denied
</FilesMatch>

# Block files without extensions
<FilesMatch "^[^.]*$">
    Require all denied
</FilesMatch>

# Block hidden files
<FilesMatch "^\\.">
    Require all denied
</FilesMatch>

# Prevent directory browsing
Options -Indexes -ExecCGI

# Disable PHP execution
<IfModule mod_php.c>
    php_flag engine off
</IfModule>

# Force download for SVG files (prevent XSS)
<FilesMatch "\.svg$">
    Header set Content-Disposition "attachment"
    Header set Content-Type "image/svg+xml"
</FilesMatch>

# Security headers for image responses
<IfModule mod_headers.c>
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
</IfModule>