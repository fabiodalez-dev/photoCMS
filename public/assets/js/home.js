function $(o){document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)}$(()=>{const o=document.getElementById("home-infinite-gallery"),M=document.querySelectorAll(".home-col");if(function(){window.matchMedia("(min-width: 768px)").matches&&M.forEach(u=>{const m=u.querySelector(".home-track");if(!m)return;const h=Array.from(m.children);if(h.length<2)return;const i=Math.floor(h.length/2),l=h.slice(0,i);for(let d=l.length-1;d>0;d--){const g=Math.floor(Math.random()*(d+1));[l[d],l[g]]=[l[g],l[d]]}m.innerHTML="",l.forEach(d=>m.appendChild(d)),l.forEach(d=>m.appendChild(d.cloneNode(!0)))})}(),o){o.classList.add("entry-init");const t=window.matchMedia("(min-width: 768px)").matches?document.querySelector(".home-desktop-wrap"):document.querySelector(".home-mobile-wrap");let u=t?Array.from(t.querySelectorAll(".home-item")):[];const m=window.innerHeight||document.documentElement.clientHeight,h=u.map(e=>{const c=e.getBoundingClientRect();return{el:e,top:c.top,left:c.left,vis:c.top<m&&c.bottom>0,near:c.top<m*2}}),i=h.filter(e=>e.vis).sort((e,c)=>e.top-c.top||e.left-c.left),l=h.filter(e=>!e.vis&&e.near);for(let e=l.length-1;e>0;e--){const c=Math.floor(Math.random()*(e+1));[l[e],l[c]]=[l[c],l[e]]}const d=h.filter(e=>!e.vis&&!e.near);for(let e=d.length-1;e>0;e--){const c=Math.floor(Math.random()*(e+1));[d[e],d[c]]=[d[c],d[e]]}const g=[...i,...l,...d].map(e=>e.el),v=6e3,w=Math.min(1200,Math.max(400,Math.floor(v*.2))),E=0,n=Math.max(1,i.length),r=Math.max(6,Math.floor(w/n)),f=Math.max(0,v-n*r),y=g.length>n?Math.max(6,Math.floor(f/(g.length-n))):0;let p=E;g.forEach((e,c)=>{const S=c<n?r:y;setTimeout(()=>e.classList.add("home-item--revealed"),p),p+=S}),requestAnimationFrame(()=>{o.style.opacity="1"}),setTimeout(()=>o.classList.remove("entry-init"),p+200)}if(M.length){if("IntersectionObserver"in window){const s=new IntersectionObserver(t=>{t.forEach(u=>{const m=u.target.querySelector(".home-track");m&&(m.style.animationPlayState=u.isIntersecting?"running":"paused")})},{threshold:.05});M.forEach(t=>s.observe(t))}window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.querySelectorAll(".home-col .home-track").forEach(s=>{s.style.animationDuration="200s"}),M.forEach(s=>{const t=s.querySelector(".home-track");if(!t)return;let u=!1,m=0,h=0;const i=n=>{const r=getComputedStyle(n).transform;if(!r||r==="none")return 0;const f=r.match(/matrix\(([^)]+)\)/);if(f)return f[1].split(",").map(parseFloat)[5]||0;const y=r.match(/matrix3d\(([^)]+)\)/);return y&&y[1].split(",").map(parseFloat)[13]||0},l=n=>{const r=t.scrollHeight/2;if(r<=0)return n;for(;n<=-r;)n+=r;for(;n>0;)n-=r;return n},d=n=>{u=!0,m=n.touches?n.touches[0].clientY:n.clientY,h=i(t),t.style.animationPlayState="paused",s.classList.add("dragging"),n.preventDefault()},g=n=>{if(!u)return;const r=n.touches?n.touches[0].clientY:n.clientY;let f=h+(r-m);f=l(f),t.style.transform=`translate3d(0, ${f}px, 0)`,n.preventDefault()},v=()=>{u&&(u=!1,s.classList.remove("dragging"))};s.addEventListener("mousedown",d),s.addEventListener("mousemove",g),window.addEventListener("mouseup",v),s.addEventListener("touchstart",d,{passive:!1}),s.addEventListener("touchmove",g,{passive:!1}),s.addEventListener("touchend",v);let w=null,E=null;s.addEventListener("mouseenter",()=>{clearTimeout(E),w=setTimeout(()=>{t.style.animationPlayState="paused"},100)}),s.addEventListener("mouseleave",()=>{if(u)return;clearTimeout(w);const n=(s.getAttribute("data-direction")||"down").toLowerCase(),r=t.scrollHeight/2,f=i(t),y=getComputedStyle(s).getPropertyValue("--home-duration").trim()||"420s",p=parseFloat(y),e=r/p,c=n==="up"?-1:1,S=2500;let q=performance.now();const b=q,a=L=>1-Math.cos(L*Math.PI/2);t.style.animation="none",t.style.animationPlayState="",t.style.transform=`translate3d(0, ${f}px, 0)`;const x=L=>{const F=Math.max(0,L-q)/1e3,A=Math.min(1,(L-b)/S),k=a(A),T=c*e*k*F*-1,C=i(t);let D=l(C+T);if(t.style.transform=`translate3d(0, ${D}px, 0)`,q=L,A<1)requestAnimationFrame(x);else{let P=0;n==="down"?P=Math.max(0,Math.min(1,-D/r)):P=Math.max(0,Math.min(1,(D+r)/r));const I=n==="up"?"homeScrollUp":"homeScrollDown";t.style.animation=`${I} ${p}s linear infinite`,t.style.animationDelay=`-${(P*p).toFixed(3)}s`,t.style.animationPlayState="running",requestAnimationFrame(()=>{t.style.transform=""})}};requestAnimationFrame(x)})})}});function Y(o){document.readyState!=="loading"?o():document.addEventListener("DOMContentLoaded",o)}Y(()=>{const o=document.getElementById("albums-carousel");if(!o)return;const M=o.parentElement,s=o.querySelectorAll(".album-carousel-item");if(!s.length)return;let t=0,u=0,m=!1,h=0,i=null;const l=()=>{const a=s[0],x=getComputedStyle(a);return a.offsetWidth+parseFloat(x.marginLeft)+parseFloat(x.marginRight)},g=l()*s.length,v=()=>{o.style.transform=`translate3d(${t}px, 0, 0)`},w=a=>a.type.includes("mouse")?a.clientX:a.touches[0].clientX,E=window.matchMedia&&window.matchMedia("(max-width: 767px)").matches,n=()=>{t-=.6,Math.abs(t)>=g&&(t=0),v(),i=requestAnimationFrame(n)};E||(i=requestAnimationFrame(n));const r=a=>{a.preventDefault(),a.stopPropagation(),m=!0,h=w(a),u=t,i&&(cancelAnimationFrame(i),i=null),o.classList.add("dragging"),document.body.style.userSelect="none"},f=a=>{if(!m)return;a.preventDefault(),a.stopPropagation();const L=w(a)-h;t=u+L,v()},y=()=>{const a=l()*s.length;Math.abs(t)>=a&&(t=t%a),t>0&&(t=-a+t%a)},p=()=>{m&&(m=!1,o.classList.remove("dragging"),document.body.style.userSelect="",y(),v(),E||setTimeout(()=>{i||(i=requestAnimationFrame(n))},1200))};o.addEventListener("mousedown",r),o.addEventListener("mousemove",f),o.addEventListener("mouseup",p),o.addEventListener("mouseleave",p),o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("touchmove",f,{passive:!1}),o.addEventListener("touchend",p),o.addEventListener("dragstart",a=>a.preventDefault()),o.addEventListener("selectstart",a=>a.preventDefault()),E||(M.addEventListener("mouseenter",()=>{i&&(cancelAnimationFrame(i),i=null)}),M.addEventListener("mouseleave",()=>{!i&&!m&&(i=requestAnimationFrame(n))}));const e=M.parentElement.querySelector(".albums-arrow-left"),c=M.parentElement.querySelector(".albums-arrow-right"),S=()=>l()*1,q=()=>{t+=S(),y(),v()},b=()=>{t-=S(),y(),v()};e&&e.addEventListener("click",q),c&&c.addEventListener("click",b)});
