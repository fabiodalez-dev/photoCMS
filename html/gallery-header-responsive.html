<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gallery</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      background: #ffffff;
      font-family: system-ui, -apple-system, sans-serif;
    }

    /* === HEADER === */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 3rem;
      border-bottom: 1px solid #eee;
      z-index: 200;
    }

    .logo {
      color: #000;
      font-size: 1.2rem;
      font-weight: 400;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    nav {
      display: flex;
      gap: 2rem;
    }

    nav a {
      color: #666;
      text-decoration: none;
      font-size: 0.85rem;
      letter-spacing: 0.1em;
      transition: color 0.3s;
    }

    nav a:hover {
      color: #000;
    }

    .menu-toggle {
      display: none;
      flex-direction: column;
      gap: 5px;
      cursor: pointer;
      padding: 5px;
    }

    .menu-toggle span {
      width: 24px;
      height: 2px;
      background: #000;
    }

    /* === SPACER per header === */
    .header-spacer {
      height: 80px;
    }

    /* === GALLERY SECTION === */
    .gallery-section {
      position: relative;
      /* L'altezza viene calcolata da JS */
    }

    .gallery-container {
      position: sticky;
      top: 80px;
      height: calc(100vh - 80px);
      display: flex;
      align-items: center;
      overflow: hidden;
      background: #ffffff;
    }

    .gallery-track {
      display: flex;
      gap: 0;
      will-change: transform;
    }

    .gallery-item {
      flex-shrink: 0;
      height: calc(100vh - 80px);
    }

    .gallery-item.horizontal {
      width: calc((100vh - 80px) * 1.5);
    }

    .gallery-item.vertical {
      width: calc((100vh - 80px) * 0.67);
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* Bordo sottile tra le foto */
    .gallery-item::after {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #fff;
    }

    /* === FOOTER === */
    footer {
      height: 50vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      border-top: 1px solid #eee;
    }

    footer p {
      color: #999;
      font-size: 0.9rem;
      letter-spacing: 0.1em;
    }

    /* === MOBILE LAYOUT === */
    .mobile-gallery {
      display: none;
    }

    /* ============================================
       TABLET: max-width 1024px
       ============================================ */
    @media (max-width: 1024px) {
      header {
        padding: 0 2rem;
      }

      .gallery-item.horizontal {
        width: calc((100vh - 80px) * 1.3);
      }

      .gallery-item.vertical {
        width: calc((100vh - 80px) * 0.6);
      }
    }

    /* ============================================
       MOBILE: max-width 768px
       Galleria verticale classica
       ============================================ */
    @media (max-width: 768px) {
      header {
        height: 60px;
        padding: 0 1.5rem;
      }

      .logo {
        font-size: 1rem;
      }

      nav {
        display: none;
      }

      .menu-toggle {
        display: flex;
      }

      .header-spacer {
        height: 60px;
      }

      /* Nascondi galleria desktop */
      .gallery-section {
        display: none;
      }

      /* Mostra galleria mobile */
      .mobile-gallery {
        display: block;
        padding: 1rem;
      }

      .mobile-gallery-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }

      .mobile-gallery-item {
        aspect-ratio: 1;
        overflow: hidden;
      }

      .mobile-gallery-item.wide {
        grid-column: span 2;
        aspect-ratio: 16/9;
      }

      .mobile-gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      footer {
        height: 30vh;
      }

      footer p {
        font-size: 0.8rem;
      }
    }

    /* ============================================
       SMALL MOBILE: max-width 480px
       ============================================ */
    @media (max-width: 480px) {
      .mobile-gallery {
        padding: 0.5rem;
      }

      .mobile-gallery-grid {
        gap: 0.3rem;
      }
    }
  </style>
</head>
<body>

<!-- 
╔══════════════════════════════════════════════════════════════════════════════╗
║                              COME FUNZIONA                                   ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║  DESKTOP/TABLET:                                                             ║
║  - Header fisso bianco (80px)                                                ║
║  - Galleria orizzontale scroll-linked                                        ║
║  - Lenis per smooth scroll                                                   ║
║  - L'altezza della sezione è calcolata in base alla larghezza del track      ║
║    così non si vede mai il background vuoto                                  ║
║                                                                              ║
║  MOBILE (< 768px):                                                           ║
║  - Header 60px con hamburger                                                 ║
║  - Galleria verticale a griglia                                              ║
║  - Scroll nativo (no effetti)                                                ║
║  - Layout masonry-like: alcune foto wide, altre quadrate                     ║
║                                                                              ║
║  CALCOLO ALTEZZA SEZIONE:                                                    ║
║  sectionHeight = trackWidth - windowWidth + windowHeight                     ║
║  Questo garantisce che lo scroll finisca esattamente quando                  ║
║  l'ultima foto raggiunge il bordo destro                                     ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝
-->

  <header>
    <div class="logo">Studio</div>
    <nav>
      <a href="#">Work</a>
      <a href="#">About</a>
      <a href="#">Contact</a>
    </nav>
    <div class="menu-toggle">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </header>

  <div class="header-spacer"></div>

  <!-- DESKTOP/TABLET: Galleria orizzontale -->
  <section class="gallery-section" id="gallerySection">
    <div class="gallery-container">
      <div class="gallery-track" id="track">
        <div class="gallery-item horizontal">
          <img src="https://picsum.photos/seed/h1/1600/1000" alt="">
        </div>
        <div class="gallery-item vertical">
          <img src="https://picsum.photos/seed/v1/800/1200" alt="">
        </div>
        <div class="gallery-item vertical">
          <img src="https://picsum.photos/seed/v2/800/1200" alt="">
        </div>
        <div class="gallery-item horizontal">
          <img src="https://picsum.photos/seed/h2/1600/1000" alt="">
        </div>
        <div class="gallery-item vertical">
          <img src="https://picsum.photos/seed/v3/800/1200" alt="">
        </div>
        <div class="gallery-item horizontal">
          <img src="https://picsum.photos/seed/h3/1600/1000" alt="">
        </div>
        <div class="gallery-item vertical">
          <img src="https://picsum.photos/seed/v4/800/1200" alt="">
        </div>
        <div class="gallery-item vertical">
          <img src="https://picsum.photos/seed/v5/800/1200" alt="">
        </div>
        <div class="gallery-item horizontal">
          <img src="https://picsum.photos/seed/h4/1600/1000" alt="">
        </div>
        <div class="gallery-item vertical">
          <img src="https://picsum.photos/seed/v6/800/1200" alt="">
        </div>
      </div>
    </div>
  </section>

  <!-- MOBILE: Galleria a griglia -->
  <div class="mobile-gallery">
    <div class="mobile-gallery-grid">
      <div class="mobile-gallery-item wide">
        <img src="https://picsum.photos/seed/h1/800/450" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/v1/400/400" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/v2/400/400" alt="">
      </div>
      <div class="mobile-gallery-item wide">
        <img src="https://picsum.photos/seed/h2/800/450" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/v3/400/400" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/h3/400/400" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/v4/400/400" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/v5/400/400" alt="">
      </div>
      <div class="mobile-gallery-item wide">
        <img src="https://picsum.photos/seed/h4/800/450" alt="">
      </div>
      <div class="mobile-gallery-item">
        <img src="https://picsum.photos/seed/v6/400/400" alt="">
      </div>
    </div>
  </div>

  <footer>
    <p>© 2024 Studio</p>
  </footer>

  <!-- Lenis -->
  <script src="https://unpkg.com/lenis@1.1.13/dist/lenis.min.js"></script>
  
  <script>
    const gallerySection = document.getElementById('gallerySection');
    const track = document.getElementById('track');
    const headerHeight = 80;
    
    let isMobile = window.innerWidth <= 768;
    let lenis;

    function initDesktopGallery() {
      if (isMobile) return;

      const trackWidth = track.scrollWidth;
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      
      // Calcola l'altezza della sezione per evitare background vuoto
      // trackWidth - windowWidth = quanto deve scorrere orizzontalmente
      // + windowHeight = per mantenere la sticky attiva fino alla fine
      const sectionHeight = (trackWidth - windowWidth) + windowHeight;
      gallerySection.style.height = `${sectionHeight}px`;

      const maxScroll = trackWidth - windowWidth;

      // Inizializza Lenis
      if (lenis) lenis.destroy();
      
      lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        smoothWheel: true,
        smoothTouch: false,
        touchMultiplier: 2
      });

      function updateGallery() {
        const rect = gallerySection.getBoundingClientRect();
        const sectionScrollHeight = gallerySection.offsetHeight - window.innerHeight;
        
        // Quanto siamo dentro la sezione
        const scrollInSection = Math.max(0, -rect.top);
        const progress = Math.min(1, scrollInSection / sectionScrollHeight);
        
        const translateX = -progress * maxScroll;
        track.style.transform = `translateX(${translateX}px)`;
      }

      function raf(time) {
        lenis.raf(time);
        updateGallery();
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);
    }

    function initMobileGallery() {
      if (!isMobile) return;

      // Su mobile, Lenis per smooth scroll semplice
      if (lenis) lenis.destroy();
      
      lenis = new Lenis({
        duration: 1,
        smoothWheel: true,
        smoothTouch: false
      });

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);
    }

    function init() {
      isMobile = window.innerWidth <= 768;
      
      if (isMobile) {
        initMobileGallery();
      } else {
        initDesktopGallery();
      }
    }

    // Debounce resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const wasMobile = isMobile;
        isMobile = window.innerWidth <= 768;
        
        if (wasMobile !== isMobile) {
          init();
        } else if (!isMobile) {
          // Ricalcola dimensioni desktop
          initDesktopGallery();
        }
      }, 200);
    });

    init();
  </script>

</body>
</html>
